!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t){var r=this,n=(wp.i18n.__,wp.blocks),a=n.registerBlockType,i=(n.Editable,wp.editor.InspectorControls),u=wp.components,s=(u.ToggleControl,u.SelectControl,u.Spinner),o=(wp.element.createElement,function(e){console.log(e)});a("visualizer/chart",{title:vjs.i10n.plugin,icon:"index-card",category:"common",supports:{html:!1},attributes:{chart_id:{type:"number",default:-1},random:{type:"number",default:-1},inspector_loading:{type:"number",default:-1},inspector:{type:"string",default:""},spinner:{type:"string",default:"v-form-spinner"},html:{type:"string",default:""},label:{type:"string",default:vjs.i10n.loading}},edit:function(e){var t=function(e,t){return"v-temp-"+e+"-"+t},n=function(e,r){jQuery('<div id="'+t(e,r)+'">').remove().insertAfter("body"),c(e,r,0)},a=function(){jQuery("#"+t(-1,-1)).remove(),jQuery("#"+t(0,0)).remove()},u=function(e,r){return 0===jQuery("#"+t(e,r)).length&&n(e,r),parseInt(jQuery("#"+t(e,r)).val())},c=function(e,r,a){0===jQuery("#"+t(e,r)).length&&n(e,r),jQuery("#"+t(e,r)).val(a)},l=function(t){jQuery("body").trigger("visualizer:gutenberg:update:settings",{settings:t,id:"visualizer-"+e.attributes.chart_id+"-"+e.attributes.random})},d=function(){return{__html:e.attributes.inspector}},g=function(){return!(void 0===e.attributes.chart_id||-1===e.attributes.chart_id)};return function(){jQuery("body").off("visualizer:gutenberg:update:preview").on("visualizer:gutenberg:update:preview",function(e,t){l(t)}),jQuery("body").off("visualizer:gutenberg:loading:chart").on("visualizer:gutenberg:loading:chart",function(t,r){e.setAttributes({label:vjs.i10n.loading,html:""})}),jQuery("body").off("visualizer:gutenberg:render:chart").on("visualizer:gutenberg:render:chart",function(t,r){e.setAttributes({label:"",html:r.data.html,chart_id:r.data.chart_id,random:r.data.random})})}(),0===u(e.attributes.chart_id,e.attributes.random)&&(g()?(o("calling getChartData for "+e.attributes.chart_id),function(t,n){1!==u(t,n)&&(c(t,n,1),o("getting chart data for "+t+n),e.setAttributes({label:vjs.i10n.loading}),wp.apiRequest({path:vjs.urls.get_chart.replace("#",t).replace("#",n)}).then(function(i){if(r.unmounting)return e.setAttributes({label:""}),i;e.setAttributes({label:""}),o("got chart data for "+t+n),o(i),e.setAttributes({inspector:i.settings}),o("triggering visualizer:gutenberg:renderinline:chart with"),o(e.attributes),jQuery("body").trigger("visualizer:gutenberg:renderinline:chart",{id:"visualizer-"+i.chart_id+"-"+i.random,charts:i.charts}),a()}))}(e.attributes.chart_id,e.attributes.random)):function(){1!==u(0,0)&&(c(0,0,1),e.setAttributes({label:vjs.i10n.loading}),wp.apiRequest({path:vjs.urls.create_form}).then(function(t){if(r.unmounting)return e.setAttributes({label:""}),t;e.setAttributes({label:"",html:t.html,chart_id:t.chart_id})}))}()),[wp.element.createElement("div",{className:e.className},e.attributes.label),function(){return e.isSelected&&g()?wp.element.createElement(i,null,wp.element.createElement("div",{className:e.attributes.spinner},wp.element.createElement(s,null)),wp.element.createElement("div",{className:e.className,dangerouslySetInnerHTML:d()})):null}(),wp.element.createElement("div",{className:e.className,dangerouslySetInnerHTML:function(){return{__html:e.attributes.html}}()})]},save:function(e){return null}}),jQuery(document).on("ready",function(){function e(e){e.preventDefault();var t=jQuery(this).parents("form.settings-form").serialize();jQuery.ajax({url:ajaxurl,data:{settings:t,action:vjs.ajax.save_settings,id:jQuery(this).parents("form.settings-form").attr("data-chart-id"),nonce:vjs.ajax.nonce},method:"POST",success:function(e){}})}function t(){var e=jQuery(this).parents("form.settings-form").serializeObject();clearTimeout(n),n=setTimeout(function(){o("triggering visualizer:gutenberg:update:preview"),jQuery("body").trigger("visualizer:gutenberg:update:preview",e)},1e3)}function r(){jQuery(this).parents("form.settings-form").find(".visualizer-error-manual").remove();try{JSON.parse(jQuery(this).val())}catch(e){jQuery('<div class="visualizer-error visualizer-error-manual">Invalid JSON: '+e+"</div>").insertAfter(jQuery(this))}}!function(){jQuery("body").on("change",".gutenberg-create-chart-source",function(e){var t=jQuery(this).parents("form"),r=jQuery(this).val();t.find(".gutenberg-create-chart-source-attributes span").hide(),t.find(".gutenberg-create-chart-source-attributes span[data-source='"+r+"']").show();var n=t.find(".gutenberg-create-chart-source-attributes span[data-source='"+r+"']").attr("data-form-enctype");t.attr("enctype",n);var a=t.find(".gutenberg-create-chart-type");a.show(),"existing"===r&&a.hide()}),jQuery("body").on("click",".gutenberg-create-chart",function(e){jQuery("body").trigger("visualizer:gutenberg:loading:chart",{});var t=jQuery(this).parents("form"),r=t.find(".gutenberg-create-chart-source").val(),n=t.find(".gutenberg-create-chart-type").val(),a=new FormData;switch(a.append("type",n),a.append("source",r),r){case"csv":var i=t.find(".visualizer-data-source-file")[0].files[0];a.append("file",i);break;case"url":a.append("remote_data",t.find(".gutenberg-create-chart-remote").val());break;case"chart":a.append("chart",t.find(".gutenberg-create-chart-chart").val());break;case"existing":a.append("chart",t.find(".gutenberg-create-chart-existing").val())}jQuery.ajax({url:vjs.urls.create_chart,data:a,method:"POST",processData:!1,contentType:!1,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",vjs.nonce)},success:function(e){o("triggering visualizer:gutenberg:render:chart for "+r),jQuery("body").trigger("visualizer:gutenberg:render:chart",{data:e})}})})}(),function(){jQuery("body").on("click",".viz-group-title",function(){var e=jQuery(this).parent();e.hasClass("open")?e.removeClass("open"):(e.parent().find(".viz-group.open").removeClass("open"),e.addClass("open")),jQuery(this).parents("form.settings-form").find(".color-picker-hex").wpColorPicker({change:t,clear:t})}).on("click",".viz-section-title",function(){jQuery(this).toggleClass("open").parent().find(".viz-section-items").toggle()}).on("click",".more-info",function(){return jQuery(this).parent().find(".viz-section-description:first").toggle(),!1})}(),function(){jQuery("body").on("change keyup","form.settings-form .control-text",t).on("change","form.settings-form .control-select, form.settings-form .control-checkbox",t).on("change keyup",'form.settings-form textarea[name="manual"]',r).on("click","form.settings-form .save-settings",e)}();var n}),function(e){e.fn.serializeObject=function(){var t=this,r={},n={},a={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,t,r){return e[t]=r,e},this.push_counter=function(e){return void 0===n[e]&&(n[e]=0),n[e]++},e.each(e(this).serializeArray(),function(){if(a.validate.test(this.name)){for(var n,i=this.name.match(a.key),u=this.value,s=this.name;void 0!==(n=i.pop());)s=s.replace(new RegExp("\\["+n+"\\]$"),""),n.match(a.push)?u=t.build([],t.push_counter(s),u):n.match(a.fixed)?u=t.build([],n,u):n.match(a.named)&&(u=t.build({},n,u));r=e.extend(!0,r,u)}}),r}}(jQuery)}]);